import tkinter as tk
from tkinter import colorchooser, messagebox, filedialog

class GraphicsApp:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("Графіка")
        self.root.resizable(False, False)

        self.color = "#000000"
        self.mode = tk.StringVar(value="line")

        top = tk.Frame(self.root)
        top.pack(fill="x", padx=10, pady=10)

        tk.Radiobutton(top, text="Лінія", variable=self.mode, value="line").pack(side="left")
        tk.Radiobutton(top, text="Коло", variable=self.mode, value="oval").pack(side="left", padx=(10, 0))

        tk.Button(top, text="Вибрати колір", command=self.pick_color).pack(side="left", padx=10)
        tk.Button(top, text="Очистити", command=self.clear).pack(side="left", padx=10)
        tk.Button(top, text="Зберегти .ps", command=self.save_ps).pack(side="left")

        self.color_label = tk.Label(top, text=f"Колір: {self.color}")
        self.color_label.pack(side="right")

        self.canvas = tk.Canvas(self.root, width=600, height=400, bg="white")
        self.canvas.pack(padx=10, pady=(0, 10))

        self.start_x = None
        self.start_y = None
        self.preview_id = None

        self.canvas.bind("<ButtonPress-1>", self.on_down)
        self.canvas.bind("<B1-Motion>", self.on_move)
        self.canvas.bind("<ButtonRelease-1>", self.on_up)

    def pick_color(self):
        chosen = colorchooser.askcolor(title="Виберіть колір")
        if chosen and chosen[1]:
            self.color = chosen[1]
            self.color_label.config(text=f"Колір: {self.color}")

    def clear(self):
        self.canvas.delete("all")

    def save_ps(self):
        file_path = filedialog.asksaveasfilename(
            defaultextension=".ps",
            filetypes=[("PostScript", "*.ps")]
        )
        if not file_path:
            return
        try:
            self.canvas.postscript(file=file_path, colormode="color")
            messagebox.showinfo("Готово", f"Збережено: {file_path}")
        except Exception as e:
            messagebox.showerror("Помилка", str(e))

    def on_down(self, event):
        self.start_x, self.start_y = event.x, event.y
        if self.preview_id is not None:
            self.canvas.delete(self.preview_id)
            self.preview_id = None

    def on_move(self, event):
        if self.start_x is None or self.start_y is None:
            return

        if self.preview_id is not None:
            self.canvas.delete(self.preview_id)

        if self.mode.get() == "line":
            self.preview_id = self.canvas.create_line(
                self.start_x, self.start_y, event.x, event.y,
                fill=self.color, width=2
            )
        else:
            self.preview_id = self.canvas.create_oval(
                self.start_x, self.start_y, event.x, event.y,
                outline=self.color, width=2
            )

    def on_up(self, event):
        if self.start_x is None or self.start_y is None:
            return

        self.preview_id = None
        self.start_x = None
        self.start_y = None

    def run(self):
        self.root.mainloop()


if __name__ == "__main__":
    GraphicsApp().run()
